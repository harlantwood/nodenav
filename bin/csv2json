#!/usr/bin/env ruby

# Usage:
# bin/csv2json source.csv target.json 

require 'csv'
require 'json'
                     
source, target = ARGV
nodes = []
rows = CSV.parse File.read(source)
rows.shift   # ignore first row (which is probably headers)
rows.each do |row|
  row.compact!     
  name = row.pop
  nodes << { name: name, tags: row } if name
end
                                    
name = target.split('/').last.split('.')[0...-1].join('.')  # remove directories and file extension
json = JSON.pretty_generate({ name: name, nodes: nodes })
File.open(target, 'w') { |file| file.write json }

