// Generated by CoffeeScript 1.6.2
(function() {
  var BASE_WEIGHT, csv, csv_data, insert, log_if, name, nodes, source, target, _, _ref;

  _ = require('underscore');

  csv = require('csv');

  BASE_WEIGHT = 0.5;

  _ref = process.argv.slice(2), source = _ref[0], target = _ref[1];

  name = _.last(target.split('/')).replace(/\.\w+$/, '');

  nodes = {};

  csv_data = csv().from.path(source);

  csv_data.to.array(function(rows) {
    var column_index, headers, node, property, property_headers, property_name, row, row_content, row_index, _i, _j, _k, _len, _len1, _len2, _results;

    headers = rows.shift();
    property_headers = headers.slice(0);
    property_headers.shift();
    _results = [];
    for (row_index = _i = 0, _len = rows.length; _i < _len; row_index = ++_i) {
      row = rows[row_index];
      for (column_index = _j = 0, _len1 = row.length; _j < _len1; column_index = ++_j) {
        node = row[column_index];
        if (node) {
          property_name = headers[column_index];
          insert(node, "type", property_name);
          insert(property_name, "nodes", node);
        }
      }
      row_content = row.shift();
      for (column_index = _k = 0, _len2 = row.length; _k < _len2; column_index = ++_k) {
        property = row[column_index];
        if (property) {
          property_name = property_headers[column_index];
          insert(row_content, property_name, property);
        }
      }
      _results.push(log_if(row_index === rows.length - 1));
    }
    return _results;
  });

  insert = function(key1, key2, key3) {
    var _base, _ref1, _ref2;

    if ((_ref1 = nodes[key1]) == null) {
      nodes[key1] = {};
    }
    if ((_ref2 = (_base = nodes[key1])[key2]) == null) {
      _base[key2] = {};
    }
    return nodes[key1][key2][key3] = BASE_WEIGHT;
  };

  log_if = function(really) {
    var json;

    if (really) {
      json = JSON.stringify(nodes, null, 4);
      return console.log(json);
    }
  };

}).call(this);
